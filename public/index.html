<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Include chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js" integrity="sha512-Wt1bJGtlnMtGP0dqNFH1xlkLBNpEodaiQ8ZN5JLA5wpc1sUlk/O5uuOMNgvzddzkpvZ9GLyYNa8w2s7rqiTk5Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        var data = {"miners" : [{'IP': '172.16.1.99', 'Fans': {'fan_0': {'RPM': 1020}, 'fan_1': {'RPM': 720}, 'fan_2': {'RPM': 0}, 'fan_3': {'RPM': 0}}, 'HR': {'board_6': {'HR': 1.16}}, 'Temps': {'board_6': {'Board': 0, 'Chip': 0}}}, {'IP': '172.16.1.98', 'Fans': {'fan_0': {'RPM': 4320}, 'fan_1': {'RPM': 5700}, 'fan_2': {'RPM': 0}, 'fan_3': {'RPM': 0}}, 'HR': {'board_8': {'HR': 0.0}}, 'Temps': {}}]}
        var data_ex = {
            "miners" : [
                {
                    "IP": "172.16.1.99",
                    "Fans": {
                        "fan_0": {
                            "RPM": 1440,
                            "Speed": 4
                        },
                        "fan_1": {
                            "RPM": 900,
                            "Speed": 4
                        },
                        "fan_2": {
                            "RPM": 0,
                            "Speed": 4
                        },
                        "fan_3": {
                            "RPM": 0,
                            "Speed": 4
                        }
                    },
                    "HR": {
                        "board_6": {
                            "HR": 4.8
                        },
                        "board_7": {
                            "HR": 4.2
                        },
                        "board_8": {
                            "HR": 3.9
                        }
                    },
                    "Temps": {
                        "board_6": {
                            "Board": 83.1875,
                            "Chip": 88.875
                        },
                        "board_7": {
                            "Board": 81.1875,
                            "Chip": 90.875
                        },
                        "board_8": {
                            "Board": 85.1875,
                            "Chip": 85.875
                        },
                    }
                },
            ]
        }

        var options_hr = {
            responsive: true,
            //maintainAspectRatio: false,
            aspectRatio: .75,
            plugins: {
                legend: {
                    display: false,
                }
            },
            scales: {
                y: {
                    min: 0,
                    suggestedMax: 6,
                    grid: {
                        color: function(context) {
                            if (context.tick.value == 4) {
                                return "rgba(0, 0, 0, 1)";
                            } else if (context.tick.value > 4) {
                                return "rgba(103, 221, 0, 1)";
                            } else if (context.tick.value < 4) {
                                return "rgba(221, 0, 103, 1)";
                            }
                        }
                    }
                }
            }
        };
        var options_temp = {
            responsive: true,
            plugins: {
                legend: {
                    display: false,
                }
            },
            //maintainAspectRatio: false,
            aspectRatio: .75,
        };
        var options_fans = {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                }
            }
        };
    </script>
    <!-- Include JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Include Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>
    <!-- Include socketIO -->
    <script src="https://cdn.socket.io/4.1.2/socket.io.min.js" integrity="sha384-toS6mmwu70G0fw54EGlWWeA4z3dyJ+dlXBtSURSKN4vyRFOcxd3Bzjj/AoOwY+Rg" crossorigin="anonymous"></script>
    <!-- Include local JS client -->
    <script src="/index.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <div class="py-5">
        <div class="container">
            <div id="chart_container" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
                <script>
                    function generate_graphs(data_graph) {
                        data_graph.miners.forEach(function(miner) {
                            var hr_canvas = document.createElement('canvas');
                            var temp_canvas = document.createElement('canvas');
                            var fan_1_canvas = document.createElement('canvas');
                            var fan_2_canvas = document.createElement('canvas');
                            var column = document.createElement('div');
                            column.className = "col"
                            var row_1 = document.createElement('div');
                            row_1.className = "row"
                            var row_2 = document.createElement('div');
                            row_2.className = "row"
                            var container_col_hr = document.createElement('div');
                            var container_col_temp = document.createElement('div');
                            var container_col_fan_1 = document.createElement('div');
                            var container_col_fan_2 = document.createElement('div');
                            container_col_hr.className = "col w-50"
                            container_col_temp.className = "col w-50"
                            container_col_fan_1.className = "col w-50"
                            container_col_fan_2.className = "col w-50"


                            container_col_hr.append(hr_canvas)
                            container_col_temp.append(temp_canvas)
                            container_col_fan_1.append(fan_1_canvas)
                            container_col_fan_2.append(fan_2_canvas)


                            var header = document.createElement('h3');
                            header.className = "text-center"
                            header.innerHTML += miner.IP
                            column.append(header)



                            row_1.append(container_col_hr)
                            row_1.append(container_col_temp)
                            column.append(row_1)
                            row_2.append(container_col_fan_1)
                            row_2.append(container_col_fan_2)
                            column.append(row_2)

                            document.getElementById('chart_container').append(column);

                            var hr_data = []
                            for (const board_num of [6, 7, 8]) {
                                if (("board_" + board_num) in miner.HR) {
                                    key = "board_"+board_num
                                    hr_data.push({label: board_num, data: [miner.HR[key].HR], backgroundColor: []})
                                    if (board_num == 6) {
                                        hr_data[0].backgroundColor = ["rgba(12, 58, 242, 1)"]
                                    } else if (board_num == 7) {
                                        hr_data[0].backgroundColor = ["rgba(0, 84, 219, 1)"]
                                    } else if (board_num == 8) {
                                        hr_data[0].backgroundColor = ["rgba(0, 139, 245, 1)"]
                                    }
                                }
                            }

                            var chart_hr = new Chart(hr_canvas, {
                                type: "bar",
                                data: {
                                    labels: ["Hashrate"],
                                    datasets: hr_data
                                },
                                options: options_hr
                            });


                            var temps_data = []
                            for (const board_num of [6, 7, 8]) {
                                if (("board_" + board_num) in miner.Temps) {
                                    key = "board_"+board_num
                                    temps_data.push({label: board_num + "Chip", data: [miner.Temps[key].Chip], backgroundColor: ["rgba(6, 92, 39, 1)"]});
                                    temps_data.push({label: board_num + "Board", data: [miner.Temps[key].Board], backgroundColor: ["rgba(255, 15, 58, 1)"]});
                                }
                            }


                            var chart_temp = new Chart(temp_canvas, {
                                type: "bar",
                                data: {
                                    labels: ["Temps"],
                                    datasets: temps_data
                                },
                                options: options_temp,
                            });



                            var fan_rpm_1 = miner.Fans.fan_0.RPM;
                            var fan_data_1 = [fan_rpm_1, (6000-fan_rpm_1)];

                            var chart_fan_1 = new Chart(fan_1_canvas, {
                                type: "doughnut",
                                data: {
                                    labels: ["Fan 1"],
                                    datasets: [
                                        {
                                            data: fan_data_1,
                                            backgroundColor: [
                                                "rgba(103, 0, 221, 1)",
                                                "rgba(255, 255, 255, 1)"
                                            ]
                                        },
                                    ]
                                },
                                options: options_fans
                            });


                            var fan_rpm_2 = miner.Fans.fan_1.RPM;
                            var fan_data_2 = [fan_rpm_2, (6000-fan_rpm_2)];
                            var chart_fan_2 = new Chart(fan_2_canvas, {
                                type: "doughnut",
                                data: {
                                    labels: ["Fan 2"],
                                    datasets: [
                                        {
                                            data: fan_data_2,
                                            backgroundColor: [
                                                "rgba(103, 0, 221, 1)",
                                                "rgba(255, 255, 255, 1)"
                                            ]
                                        },
                                    ]
                                },
                                options: options_fans
                            });
                        });
                    }
                   generate_graphs(data);
                </script>
            </div>
        </div>
    </div>
</body>
</html>